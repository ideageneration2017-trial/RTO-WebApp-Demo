<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timetable ‚Äî Student Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
/* CSS from StudentAssessmentDashboard.html for consistency */
:root{
  --sidebar-bg: #eaf6fb;
  --accent: #e53935;
  --brand-1: #0f766e;
  --card-bg: #ffffff;
  --muted: #6b7280;
  --shadow: 0 6px 20px rgba(18,38,63,0.08);
  --radius: 12px;
  --max-width: 1200px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  background:#f7fafc;
  color:#111827;
  line-height:1.3;
}
a{color:inherit;text-decoration:none}
.app{display:flex;min-height:100vh;gap:24px}
/* Sidebar */
.sidebar{
  width:260px;
  background:var(--sidebar-bg);
  padding:20px 18px;
  border-right:1px solid rgba(15,23,42,0.03);
  display:flex;
  flex-direction:column;
  gap:16px;
  position:fixed;
  left:0;
  top:0;
  bottom:0;
}
.nav a{
  display:flex;
  gap:12px;
  align-items:center;
  padding:10px 10px;
  border-radius:8px;
  color: #0f1724;
  font-size:14px;
  font-weight:500;
}
.nav a:hover{ background: rgba(15,23,42,0.03) }
.nav .group-title {
  color: var(--muted);
  font-size: 12px;
  padding: 10px 6px 2px 6px;
  font-weight: 600;
  text-transform: uppercase;
}
/* Main content area */
.main{
  flex:1;
  padding:28px;
  max-width: calc(var(--max-width) - 40px);
  margin: 0 auto;
  width:100%;
  margin-left: 260px; /* leave space for fixed sidebar */
}
/* Topbar */
.topbar{
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:10px;
  margin-bottom:20px;
}
.profile-avatar{
  width:40px;
  height:40px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid white; 
  box-shadow:0 4px 12px rgba(2,6,23,0.08);
}
.profile-container{position:relative;display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
#profile-dropdown-menu{
  position:absolute;right:0;margin-top:12px;width:260px;
  background:#fff;border:1px solid #e5e7eb;border-radius:8px;
  box-shadow:0 10px 30px rgba(2,6,23,0.12);z-index:50;padding-bottom:8px;
}
#profile-dropdown-menu.hidden{display:none}
#dropdown-arrow{color:#9ca3af;transition:transform .18s ease}
/* Page header */
.page-header{ padding-bottom:14px; }
.page-header h1{margin:0;font-size:20px;font-weight:700}
.page-header p{margin:6px 0 0;color:var(--muted);font-size:13px}
/* Small text */
.small{ font-size:12px; color:var(--muted) }
/* Buttons */
.btn{
  padding:5px 10px;
  border-radius:6px;
  font-size:12px;
  font-weight:600;
  border:0;
  cursor:pointer;
}
.btn.primary{ background:var(--brand-1); color:#fff; margin-right:6px; }
.btn.ghost{ background:transparent; border:1px solid rgba(15,23,42,0.06); color:#374151; }
.btn-md{ padding:8px 16px; font-size:14px; }
/* --- NEW Timetable Layout Styles --- */
.layout{
  display:grid;
  grid-template-columns: 1fr 380px; /* Swapped columns: calendar on left, panel on right */
  gap:20px;
  align-items:start;
  margin-top:24px;
}
@media (max-width: 980px) {
  .layout { grid-template-columns: 1fr; }
}
/* Calendar Styles */
.calendar-panel{
  background:var(--card-bg);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  min-height: 600px;
}
.calendar-nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.calendar-grid{
  display:grid;
  grid-template-columns: 60px repeat(7, 1fr); /* Time column + 7 days */
  gap: 2px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
  flex-grow: 1;
}
.day-header, .time-label, .day-cell{
  padding: 8px 6px;
  background: #f9fafb;
  font-size: 13px;
  font-weight: 600;
  text-align: center;
  border-right: 1px solid #e5e7eb;
  border-bottom: 1px solid #e5e7eb;
  position: relative;
}
.time-label{
  text-align: right;
  background: #f1f5f9;
  font-weight: 500;
  border-right: 1px solid #e5e7eb;
  border-bottom: 1px solid #e5e7eb;
}
.day-cell{
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
  height: 60px; /* Represents one hour */
}
.day-cell:hover{ background: #f0f4f7; }
.event-item{
  position: absolute;
  left: 0;
  right: 0;
  background: #a7f3d0; /* Very light teal/mint green */
  color: #047857; /* Darker green for text */
  padding: 4px 6px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  overflow: hidden;
  text-overflow: ellipsis;
  /* white-space: nowrap; */ /* Removed to allow wrapping */
  z-index: 10;
  cursor: pointer;
  line-height: 1.2;
}
.assessment-item{
  position: absolute;
  left: 0;
  right: 0;
  background: #fecaca; /* Lighter red/salmon pink for assessments */
  color: #dc2626; /* Darker red for text */
  padding: 4px 6px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  overflow: hidden;
  text-overflow: ellipsis;
  /* white-space: nowrap; */ /* Removed to allow wrapping */
  z-index: 10;
  cursor: pointer;
  line-height: 1.2;
}
/* Panel Styles */
.panel{
  background:var(--card-bg);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow)
}
.filters{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:10px;
}
.select, .search {
  background:#f9fafb;
  border:1px solid #e5e7eb;
  padding:10px 14px;
  border-radius:8px;
  display:flex;
  align-items:center;
  gap:10px;
}
.search input{ border: none; background: transparent; flex: 1; outline: none; }
.select select{ border: none; background: transparent; flex: 1; outline: none; }
.upcoming{ margin-top:18px; display:flex; flex-direction:column; gap:10px; max-height:400px; overflow-y:auto; }
.session-card{
  padding:12px;
  border-radius:10px;
  background:rgba(15,23,42,0.02);
  display:flex;
  flex-direction:column;
  gap:6px;
  cursor:pointer;
  transition: all 0.2s;
}
.session-card:hover{
  background:rgba(15,23,42,0.05);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}
.session-top{ display:flex; justify-content:space-between; align-items:center }
.session-title{ font-weight:600; font-size:14px; }
.session-meta{ font-size:12px; color:var(--muted); }
.detail-panel{ margin-bottom:20px; display:flex; flex-direction:column; gap:12px; }
.detail-row{ display:flex; justify-content:space-between; align-items:center }
.detail-row .label{ font-weight: 600; }
</style>
</head>
<body>
<div class="app">
  <aside id="sidebar" class="sidebar">
    <div style="padding:16px;display:flex;justify-content:center;">
      <img src="isoft.jpg" alt="ISoft Logo" style="max-height:56px;object-fit:contain">
    </div>
    <nav class="nav" aria-label="Main navigation">
      <div class="group-title">Main</div>
      <a href="StudentDashboard.html">üè† Dashboard</a>
      <a href="StudentMyCourses.html">üìö My Courses</a>
      <a href="StudentAssessmentDashboard.html">üìù Assessments</a>
      <a href="#" style="background:#60a5fa;color:#fff">üìÖ Timetable</a>
      
      <div class="group-title">Admin</div>
      <a href="#">üí≥ Fees & Payments</a>
      <a href="#">üìÇ Documents</a>
      <a href="#">üí¨ Messages</a>
      <div class="group-title">CRICOS</div>
      <a href="#">üõÇ COE & Visa</a>
      <div class="group-title">Support</div>
      <a href="#">ü§ñ Ask AI</a>
      <a href="#">üìû Contact Trainer</a>
    </nav>
  </aside>
  <div class="main">
    <div class="topbar">
      <div class="profile-container" id="profile-root">
        <div id="profile-menu-button" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
          <img src="owner.jpg" alt="avatar" class="profile-avatar">
          <div style="font-weight:600;color:#0f1724">John Edward</div>
          <span id="dropdown-arrow" class="material-icons">expand_more</span>
        </div>
        <div id="profile-dropdown-menu" class="hidden" aria-hidden="true">
          <div style="padding:16px;border-bottom:1px solid #e5e7eb">
            <div style="font-weight:bold;color:#1f2937">Hi, John</div>
            <div style="font-size:14px;color:#6b7280">john.edward@isoftanz.com.au</div>
          </div>
          <ul style="list-style:none;margin:0;padding:0">
            <li><a href="#" style="display:flex;align-items:center;padding:10px 16px;color:#374151">
              <span class="material-icons" style="margin-right:8px">person</span>Edit Profile</a></li>
            <li><a href="#" style="display:flex;align-items:center;padding:10px 16px;color:#374151">
              <span class="material-icons" style="margin-right:8px">settings</span>Account settings</a></li>
            <li><a href="#" style="display:flex;align-items:center;padding:10px 16px;color:#374151">
              <span class="material-icons" style="margin-right:8px">help_outline</span>Support</a></li>
            <li><a href="#" style="display:flex;align-items:center;padding:10px 16px;color:#374151;border-top:1px solid #e5e7eb;margin-top:4px">
              <span class="material-icons" style="margin-right:8px">logout</span>Sign out</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="page-header">
     
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap">
      <div>
        <div style="font-weight:700;font-size:22px">Your timetable</div>
        <div class="small">View upcoming classes, join online sessions and sync to your calendar</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn ghost btn-md" onclick="exportICal()">Export iCal</button>
        <button class="btn ghost btn-md" onclick="openSync()">Sync ‚Üí Google</button>
        <button class="btn primary btn-md" onclick="openRequest()">Request change</button>
      </div>
    </div>
    <div class="layout">
      <section class="calendar-panel">
        <div class="calendar-nav">
          <button class="btn ghost" onclick="changeWeek(-1)">&larr; Prev Week</button>
          <div id="weekRange" style="font-weight:600"></div>
          <button class="btn ghost" onclick="changeWeek(1)">Next Week &rarr;</button>
        </div>
        <div class="calendar-grid" id="calendarGrid">
          </div>
      </section>
      <aside>
        <div class="panel detail-panel" id="selectedDetail">
          <div style="font-weight:700;font-size:16px;">Session Details</div>
          <div id="sessionInfo">
            <div style="text-align:center; color:var(--muted)">Select a session to see details.</div>
          </div>
        </div>
        <div class="panel">
          <div style="font-weight:700">Filters & Upcoming</div>
          <div class="filters">
            <div class="search" role="search"><span>üîé</span><input id="search" placeholder="Search course, unit, trainer"></div>
            <div style="display:flex;gap:8px">
              <div class="select" style="flex:1">
                <select id="courseSelect">
                  <option value="all">All courses</option>
                </select>
              </div>
              <div class="select" style="width:110px">
                <select id="mode">
                  <option value="all">All</option>
                  <option value="online">Online</option>
                  <option value="face">Face-to-face</option>
                </select>
              </div>
            </div>
          </div>
          <div style="margin-top:20px;font-weight:700">Upcoming sessions</div>
          <div class="upcoming" id="upcomingList" aria-live="polite">
            </div>
        </div>
      </aside>
    </div>
    <div style="margin-top:18px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div class="quick-links">
          <a class="small text-muted" href="#">Help center</a>
          <a class="small text-muted" href="#">Policies</a>
          <a class="small text-muted" href="#">Contact support</a>
        </div>
        <div class="small text-muted">¬© 2025 iSOFT ‚Äî Student portal</div>
    </div>
  </div>
</div>
<div id="aiWidget" style="position:fixed;right:20px;bottom:20px;z-index:80; cursor:pointer;" onclick="openChat()">
  <div style="
    width:50px;
    height:50px;
    border-radius:50%;
    overflow:hidden;
    box-shadow:0 4px 8px rgba(0,0,0,0.2);
    transition: transform 0.2s;
  " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
    <img src="AI2.png" alt="AI Assistant" style="width:100%;height:100%;object-fit:cover;">
  </div>
</div>
<div id="chatModal" style="display:none;position:fixed;right:20px;bottom:90px;width:380px;z-index:90">
  <div style="background:white;border-radius:14px;box-shadow:0 24px 60px rgba(2,6,23,0.45);overflow:hidden">
    <div style="padding:12px 14px;display:flex;justify-content:space-between;align-items:center">
      <div style="display:flex;gap:10px;align-items:center">
        <div style="width:36px;height:36px;border-radius:8px;background:linear-gradient(90deg,#06b6d4,#0f766e);display:flex;align-items:center;justify-content:center;color:white;font-weight:700">AI</div>
        <div>
          <div style="font-weight:700">AI Assistant</div>
          <div class="small text-muted">Ask about fees, COE, or study tips</div>
        </div>
      </div>
      <div>
        <button onclick="closeChat()" style="border:0;background:transparent;font-weight:700;cursor:pointer">‚úï</button>
      </div>
    </div>
    <div style="height:320px;background:#f8fafc;padding:12px;overflow:auto">
      <div style="max-width:80%;padding:10px;background:white;border-radius:10px;margin-bottom:10px">Hi! How can I help with your enrolment or study tasks?</div>
      <div style="max-width:80%;margin-left:auto;padding:10px;background:#eff6ff;border-radius:10px;margin-bottom:10px">What is the due date for my next assessment?</div>
    </div>
    <div style="padding:10px;border-top:1px solid rgba(15,23,42,0.03);display:flex;gap:8px;align-items:center">
      <input id="chatInput" placeholder="Ask something..." style="flex:1;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.06)" />
      <button style="background:var(--brand-1);border:0;padding:10px 12px;border-radius:10px;color:white;cursor:pointer" onclick="sendTest()">Send</button>
    </div>
  </div>
</div>
<script>
  // Profile dropdown logic
  const profileMenuButton = document.getElementById('profile-menu-button');
  const profileDropdownMenu = document.getElementById('profile-dropdown-menu');
  const dropdownArrow = document.getElementById('dropdown-arrow');
  profileMenuButton.addEventListener('click', (e) => {
      e.stopPropagation();
      const isHidden = profileDropdownMenu.classList.toggle('hidden');
      profileDropdownMenu.setAttribute('aria-hidden', isHidden ? 'true' : 'false');
      dropdownArrow.style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
  });
  window.addEventListener('click', (event) => {
      if (!profileMenuButton.contains(event.target) && !profileDropdownMenu.contains(event.target)) {
          profileDropdownMenu.classList.add('hidden');
          profileDropdownMenu.setAttribute('aria-hidden','true');
          dropdownArrow.style.transform = 'rotate(0deg)';
      }
  });
  // AI Chat open/close
  function openChat(){ document.getElementById('chatModal').style.display = 'block'; }
  function closeChat(){ document.getElementById('chatModal').style.display = 'none'; }
  function sendTest(){
    const input = document.getElementById('chatInput');
    if(!input || !input.value.trim()) return;
    const container = document.querySelector('#chatModal > div:nth-child(2)');
    const bubble = document.createElement('div');
    bubble.style.cssText = 'max-width:80%;margin-left:auto;padding:10px;background:#eff6ff;border-radius:10px;margin-bottom:10px';
    bubble.textContent = input.value;
    container.appendChild(bubble);
    container.scrollTop = container.scrollHeight;
    input.value = '';
  }
  // Timetable Scripts
  const sessions = [
    { id:1, course:"Diploma of Business", code:"BSB50120", unit:"SITXWHS101", start:"2025-10-28T09:00", trainer:"M. Turner", end:"2025-10-28T12:00", location:"Room 12, Campus A", mode:"face", notes:"Bring safety form", type:"session" },
    { id:2, course:"Diploma of Business", code:"BSB50120", unit:"BSBTEC101", trainer:"J. Smith", start:"2025-10-29T13:00", end:"2025-10-29T15:00", location:"Zoom (link)", mode:"online", notes:"Zoom link in course resources", type:"session" },
    { id:3, course:"Certificate IV in IT", code:"ICT40120", unit:"ICT401A", trainer:"A. Lee", start:"2025-10-30T10:00", end:"2025-10-30T13:00", location:"Lab 3", mode:"face", notes:"Lab computers reserved", type:"session" },
    { id:4, course:"Diploma of Business", code:"BSB50120", unit:"BSBTEC101", title:"Assessment - Due", trainer:"N/A", start:"2025-10-31T09:00", end:"2025-10-31T10:00", location:"Online Submission", mode:"online", notes:"Business Communication Assessment is due", type: "assessment" }
  ];
  const courseSelect = document.getElementById('courseSelect');
  const upcomingList = document.getElementById('upcomingList');
  const calendarGrid = document.getElementById('calendarGrid');
  const selectedDetail = document.getElementById('selectedDetail');
  function formatTimeRange(s,e){
    const a=new Date(s), b=new Date(e);
    return a.toLocaleDateString() + ' ‚Ä¢ ' + a.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}) + ' - ' + b.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  }
  (function populateCourses(){
    const names = [...new Map(sessions.map(s=>[s.code, s]))].map(x=>x[0]);
    names.forEach(code=>{
      const opt = document.createElement('option'); opt.value=code; opt.textContent=code; courseSelect.appendChild(opt);
    });
  })();
  function renderUpcoming(filterCode='all'){
    upcomingList.innerHTML='';
    const filtered = sessions.filter(s => filterCode==='all' ? true : s.code===filterCode);
    filtered.sort((a,b)=> new Date(a.start)-new Date(b.start)).forEach(s=>{
      const el = document.createElement('div'); el.className='session-card'; el.tabIndex=0;
      el.innerHTML = `
        <div class="session-top">
          <div>
            <div class="session-title">${s.course} ‚Äî ${s.unit}</div>
            <div class="session-meta">${s.code} ‚Ä¢ ${new Date(s.start).toLocaleDateString()} ‚Ä¢ ${new Date(s.start).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
          </div>
          <div class="session-meta">${s.mode === 'online' ? 'Online' : s.location}</div>
        </div>
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button class="btn primary" onclick="selectSession(${s.id});event.stopPropagation();">View</button>
          ${s.mode==='online' ? '<button class="btn ghost" onclick="joinSession('+s.id+');event.stopPropagation();">Join</button>' : ''}
        </div>
      `;
      el.addEventListener('click', ()=> selectSession(s.id));
      upcomingList.appendChild(el);
    });
    if(filtered.length===0){ upcomingList.innerHTML='<div class="small">No sessions found.</div>' }
  }
  let weekOffset=0;
  function renderWeek(){
    calendarGrid.innerHTML = '';
    const baseDate = new Date(sessions[0].start);
    const startOfWeek = getStartOfWeek(baseDate, weekOffset);
    document.getElementById('weekRange').textContent = `${startOfWeek.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })} - ${new Date(startOfWeek.getTime() + 6 * 24 * 60 * 60 * 1000).toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}`;
    // Create headers
    calendarGrid.innerHTML += '<div class="day-header" style="visibility:hidden; border:none; background:none;"></div>'; // Spacer for time column
    for (let i = 0; i < 7; i++) {
        const day = new Date(startOfWeek);
        day.setDate(startOfWeek.getDate() + i);
        calendarGrid.innerHTML += `<div class="day-header">${day.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</div>`;
    }
    // Create time grid and events
    for (let hour = 8; hour <= 17; hour++) {
      calendarGrid.innerHTML += `<div class="time-label">${hour}:00</div>`;
      for (let i = 0; i < 7; i++) {
        const day = new Date(startOfWeek);
        day.setDate(startOfWeek.getDate() + i);
        const cell = document.createElement('div');
        cell.className = 'day-cell';
        cell.setAttribute('data-day', day.toISOString().slice(0, 10));
        cell.setAttribute('data-hour', hour);
        
        const daySessions = sessions.filter(s => {
          const sDate = new Date(s.start);
          return sDate.getFullYear() === day.getFullYear() &&
                 sDate.getMonth() === day.getMonth() &&
                 sDate.getDate() === day.getDate() &&
                 sDate.getHours() === hour;
        });
        
        daySessions.forEach(s => {
          const start = new Date(s.start);
          const end = new Date(s.end);
          const duration = (end - start) / (1000 * 60); // duration in minutes
          const topPosition = (start.getMinutes() / 60) * 60; // top offset in px
          const height = (duration / 60) * 60; // height in px
          
          const eventEl = document.createElement('div');
          eventEl.style.top = `${topPosition}px`;
          eventEl.style.height = `${height}px`;
          
          if (s.type === 'assessment') {
            eventEl.className = 'assessment-item';
            eventEl.innerHTML = `<div>${s.unit}</div><div style="font-weight:400">${s.title}</div>`;
          } else {
            eventEl.className = 'event-item';
            eventEl.innerHTML = `<div>${s.unit}</div><div style="font-weight:400">${s.trainer}</div>`;
          }

          eventEl.onclick = (e) => { e.stopPropagation(); selectSession(s.id); };
          cell.appendChild(eventEl);
        });
        calendarGrid.appendChild(cell);
      }
    }
  }
  function getStartOfWeek(baseDate, offset){
    const day = baseDate.getDay();
    const diff = baseDate.getDate() - day + (day===0?-6:1); // Adjust for Monday start (ISO week)
    const monday = new Date(baseDate.setDate(diff));
    monday.setHours(0,0,0,0);
    const target = new Date(monday);
    target.setDate(monday.getDate() + (offset*7));
    return target;
  }
  function changeWeek(n){ weekOffset+=n; renderWeek(); }
  function selectSession(id){
    const s = sessions.find(x=>x.id===id);
    if(!s) return;
    document.getElementById('sessionInfo').innerHTML = `
      <div class="detail-row"><div class="label">Course</div><div class="small">${s.course} (${s.code})</div></div>
      <div class="detail-row"><div class="label">Unit</div><div class="small">${s.unit}</div></div>
      <div class="detail-row"><div class="label">Trainer</div><div class="small">${s.trainer}</div></div>
      <div class="detail-row"><div class="label">Location</div><div class="small">${s.location} (${s.mode})</div></div>
      <div class="detail-row"><div class="label">When</div><div class="small">${formatTimeRange(s.start,s.end)}</div></div>
      <div style="display:flex;gap:8px;margin-top:16px;">
        <button class="btn primary btn-md" id="joinBtn" onclick="joinSession(${s.id})">Join session</button>
        <button class="btn ghost btn-md" id="markBtn">Mark attendance</button>
      </div>
      <div style="margin-top:16px;">
        <div class="small" style="font-weight:700;margin-bottom:6px">Notes</div>
        <div class="small" style="background:rgba(15,23,42,0.02);padding:8px;border-radius:8px">${s.notes}</div>
      </div>
    `;
    document.getElementById('selectedDetail').scrollIntoView({behavior:'smooth', block:'center'});
  }
  function joinSession(id){ alert('Open/join session (replace with real link). Session id: '+id); }
  function markAttendance(){ alert('Mark attendance (integration with attendance API)'); }
  function exportICal(){ alert('Export iCal (implement server endpoint to generate .ics)'); }
  function openSync(){ alert('Open sync modal (connect to Google/Outlook)'); }
  function openRequest(){ alert('Request timetable change (open support flow)'); }
  document.getElementById('search').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const filtered = sessions.filter(s => 
          s.course.toLowerCase().includes(query) ||
          s.unit.toLowerCase().includes(query) ||
          s.trainer.toLowerCase().includes(query) ||
          (s.title && s.title.toLowerCase().includes(query)) // Search assessment titles too
      );
      renderUpcomingFromSearch(filtered);
  });
  function renderUpcomingFromSearch(filteredSessions) {
      upcomingList.innerHTML = '';
      if (filteredSessions.length === 0) {
          upcomingList.innerHTML = '<div class="small">No sessions found.</div>';
          return;
      }
      filteredSessions.forEach(s => {
          const el = document.createElement('div');
          el.className = 'session-card';
          el.tabIndex = 0;
          el.innerHTML = `
              <div class="session-top">
                  <div>
                      <div class="session-title">${s.course} ‚Äî ${s.unit}</div>
                      <div class="session-meta">${s.code} ‚Ä¢ ${new Date(s.start).toLocaleDateString()} ‚Ä¢ ${new Date(s.start).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
                  </div>
                  <div class="session-meta">${s.mode === 'online' ? 'Online' : s.location}</div>
              </div>
              <div style="margin-top:8px; display:flex; gap:8px;">
                  <button class="btn primary" onclick="selectSession(${s.id});event.stopPropagation();">View</button>
                  ${s.mode === 'online' ? '<button class="btn ghost" onclick="joinSession(' + s.id + ');event.stopPropagation();">Join</button>' : ''}
              </div>
          `;
          el.addEventListener('click', () => selectSession(s.id));
          upcomingList.appendChild(el);
      });
  }
  // init
  renderUpcoming();
  renderWeek();
  courseSelect.addEventListener('change', ()=> renderUpcoming(courseSelect.value));
  document.getElementById('mode').addEventListener('change', (e) => {
    const mode = e.target.value;
    const filtered = sessions.filter(s => mode === 'all' || s.mode === mode);
    renderUpcomingFromSearch(filtered);
  });
</script>
</body>

</html>
